{% extends 'base.html' %}
{% load static %}
{% load tz %}
{% load crispy_forms_tags %}

{% block title %}
  TKS | My Transaction Details - {{ transaction_details.pk }}
{% endblock %}

{% block style %}
  <link rel="stylesheet" href="{% static 'css/sf/transaction_details_sf.css' %}" />
  <link rel="stylesheet" href="{% static 'css/sf/navbar_sf.css' %}" />  
{% endblock %}

{% block main_content %}
    {% include 'sf/navbar_sf.html' %}
    <main class="">
        <div class="row justify-content-center mx-5 px-5 my-3">
            <div class="col-xl-4 col-lg-4 col-md-5 col-sm-12 col-12 mb-4 mx-0 px-0">
                <div class="px-3">
                    <div class="card justify-content-center mb-5 px-5 py-2">
                        <div class="details my-3">
                            <div class="subtitle">  DateTime of Borrow: </div>
                            <div class="transaction-info"> {% timezone "Asia/Manila" %} {{ transaction_details.borrow_datetime }} {% endtimezone %} </div>
                        </div>
                        <div class="details my-3">
                            <div class="subtitle"> DateTime of Return: </div>
                            <div class="transaction-info">{% timezone "Asia/Manila" %} {{ transaction_details.return_datetime }} {% endtimezone %}  </div>
                        </div>
                        <div class="details my-3">
                            <div class="subtitle"> Status: </div>
                            <div class="transaction-info" id="status" data-status="{{ transaction_details.status }}"> {{ transaction_details.status }} </div>
                        </div>      
                    </div>
                </div>
            </div>
            <div class="col-xl-8 col-lg-8 col-md-7 col-sm-12 col-12 mx-0 px-0">
                <div class="px-3">
                    <div class="container mx-0 px-0">
                        <div class="d-flex align-items-center mx-0 px-0">
                            <div class="tools-borrowed-text"> TOOLS BORROWED </div>
                            {% if transaction_details.status == 'RESERVED' %}
                                <button type="button" class="void-btn" data-bs-toggle="modal" data-bs-target="#voidModal"> VOID </button>
                            {% endif %}
                        </div>
                        {% if transaction_details.status == 'RESERVED' %}
                            <form action="" method="POST">
                                {% csrf_token %}
                                <div class="modal fade" id="voidModal" tabindex="-1" aria-labelledby="voidModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="voideModalLabel">Void Transaction</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            Are you sure you want to void this transaction?
                                        </div>
                                        <div class="modal-footer">
                                            <input type="submit" name="void" value="Yes, I'm sure" class="btn btn-primary" />
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            </form>    
                        {% endif %} 
                    </div>
                    
                    <hr>

                    <div class="tools-cards">
                        {% if transaction_details.status == 'VOIDED' or transaction_details.status == 'RETURNED' or transaction_details.status == 'RETURNED WITH DAMAGE' or transaction_details.status == 'MISSING' %}
<<<<<<< HEAD
                            {% for tool in dumps %}
=======
                            {% for tool in finished %}
>>>>>>> accbb7e6abcbfcbe7d91d12791442552f6711e2f
                                <div class="p-2">
                                    <div class="tool-info-wrapper">
                                        <div class="tool-name mb-2"> {{ tool.tool_borrowed.tool_name }} </div>
                                        <img src="{{ tool.tool_borrowed.tool_image.url }}" alt="">
                                    </div>
                                </div>
                            {% endfor %}
                    
                        {% elif transaction_details.status != "VOIDED" or transaction_details.status != "RETURNED" %}
                            {% for tool in tools %}
                                <div class="p-2">
                                    <div class="tool-info-wrapper">
                                        <div class="tool-name mb-2"> {{ tool.tool_name }} </div>
                                        <img src="{{ tool.tool_image.url }}" alt="">
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </main>
{% endblock %}

{% block js %}
    <script src="{% static 'js/sf/transaction_details_sf.js' %}"></script>
{% endblock %} 